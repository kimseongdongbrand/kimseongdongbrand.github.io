<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>(ì£¼)í™ˆì¼€ì–´ ê¹¨ë—í•œì§‘ - ê´€ë¦¬ì</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background: #f5f7fa; padding: 20px; }
        .header { background: linear-gradient(135deg, #00AEEF 0%, #0088CC 100%); color: white; padding: 30px; border-radius: 15px; margin-bottom: 20px; text-align: center; }
        .header h1 { font-size: 28px; margin-bottom: 10px; }
        .action-btn { padding: 12px 24px; background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; margin: 5px; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .stat-number { font-size: 36px; font-weight: 800; }
        .stat-label { font-size: 13px; color: #666; font-weight: 600; margin-top: 5px; }
        .section { background: white; padding: 25px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
        .section-header h2 { color: #2c3e50; font-size: 20px; }
        .manager-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; }
        .manager-card { background: #f8f9fa; padding: 20px; border-radius: 12px; border-left: 4px solid #00AEEF; cursor: pointer; position: relative; transition: all 0.3s; }
        .manager-card:hover { background: #e8f4f8; transform: scale(1.02); }
        .manager-name { font-size: 20px; font-weight: 800; color: #2c3e50; margin-bottom: 8px; padding-right: 40px; }
        .manager-remove-btn { position: absolute; top: 10px; right: 10px; width: 28px; height: 28px; border: none; background: #e74c3c; color: white; border-radius: 50%; font-size: 18px; cursor: pointer; z-index: 999; line-height: 26px; font-weight: bold; }
        .manager-remove-btn:hover { background: #c0392b; transform: scale(1.1); }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin: 5px; font-size: 13px; color: white; }
        .btn-primary { background: #00AEEF; }
        .btn-success { background: #27ae60; }
        .btn-danger { background: #e74c3c; }
        .btn-warning { background: #f39c12; }
        .btn-info { background: #3498db; }
        .filter-btn { padding: 10px 20px; border: 2px solid #e0e0e0; background: white; border-radius: 8px; cursor: pointer; font-weight: 600; margin: 5px; }
        .filter-btn.active { background: #00AEEF; color: white; border-color: #00AEEF; }
        .booking-card { background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 12px; border-left: 5px solid #e0e0e0; }
        .customer-name { font-size: 22px; font-weight: 800; color: #2c3e50; margin-bottom: 12px; }
        .info-item { margin: 8px 0; font-size: 14px; }
        .booking-actions { display: flex; gap: 8px; margin-top: 12px; flex-wrap: wrap; align-items: center; }
        .booking-actions select { padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; }
        .status-badge { display: inline-block; padding: 10px 20px; border-radius: 20px; font-size: 14px; font-weight: 700; margin: 8px 8px 8px 0; }
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; padding: 20px; }
        .modal.show { display: flex; }
        .modal-content { background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; }
        .form-group input { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; }
        .modal-buttons { display: flex; gap: 10px; margin-top: 25px; }
        .modal-buttons button { flex: 1; padding: 14px; }
        
        .confirm-modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 2000; align-items: center; justify-content: center; }
        .confirm-modal.show { display: flex; }
        .confirm-content { background: white; padding: 30px; border-radius: 15px; max-width: 400px; width: 90%; text-align: center; }
        .confirm-content h3 { font-size: 20px; margin-bottom: 20px; color: #2c3e50; }
        .confirm-buttons { display: flex; gap: 10px; margin-top: 25px; }
        .confirm-buttons button { flex: 1; padding: 14px; border: none; border-radius: 10px; font-weight: 700; font-size: 16px; cursor: pointer; }
        
        .calendar-modal-large { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 1500; align-items: center; justify-content: center; padding: 20px; overflow-y: auto; }
        .calendar-modal-large.show { display: flex; }
        .calendar-big-container { background: white; border-radius: 20px; padding: 30px; max-width: 900px; width: 100%; max-height: 90vh; overflow-y: auto; }
        .calendar-big-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .calendar-big-nav-btn { padding: 10px 20px; border: none; background: #00AEEF; color: white; font-size: 18px; border-radius: 10px; cursor: pointer; font-weight: 700; }
        .calendar-big-title { font-size: 28px; font-weight: 700; color: #2c3e50; }
        .calendar-big-weekdays { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; margin-bottom: 15px; }
        .calendar-big-weekday { text-align: center; font-weight: 700; color: #666; padding: 15px 0; font-size: 16px; background: #f8f9fa; border-radius: 8px; }
        .calendar-big-days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; }
        .calendar-big-day { min-height: 100px; border: 2px solid #e0e0e0; background: white; border-radius: 12px; padding: 10px; cursor: pointer; transition: all 0.3s; position: relative; }
        .calendar-big-day:hover { border-color: #00AEEF; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,174,239,0.2); }
        .calendar-big-day-number { font-size: 20px; font-weight: 700; color: #2c3e50; margin-bottom: 8px; }
        .calendar-big-day.has-bookings { background: #e8f4f8; border-color: #00AEEF; }
        .calendar-booking-count { background: #00AEEF; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 700; display: inline-block; }
        .calendar-big-day.empty { border: none; cursor: default; background: transparent; }
        .calendar-close-btn { margin-top: 20px; width: 100%; padding: 15px; background: #95a5a6; color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 700; cursor: pointer; }
        
        .finance-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 13px; table-layout: auto; }
        .finance-table th, .finance-table td { padding: 12px 8px; text-align: left; border-bottom: 1px solid #e0e0e0; white-space: nowrap; }
        .finance-table th { background: #f8f9fa; font-weight: 700; color: #2c3e50; font-size: 12px; }
        .finance-table th:nth-child(1) { min-width: 100px; }
        .finance-table th:nth-child(2) { min-width: 200px; }
        .finance-table th:nth-child(3) { min-width: 60px; }
        .finance-table th:nth-child(4) { min-width: 150px; }
        .finance-table th:nth-child(5) { min-width: 80px; }
        .finance-table th:nth-child(6) { min-width: 80px; }
        .finance-table th:nth-child(7) { min-width: 100px; }
        .finance-table th:nth-child(8) { min-width: 100px; }
        .finance-table th:nth-child(9) { min-width: 100px; }
        .finance-table td:nth-child(2) { white-space: normal; }
        .finance-table td:nth-child(4) { white-space: normal; }
        .finance-table tr:hover { background: #f8f9fa; }
        .profit-positive { color: #27ae60; font-weight: 700; }
        .profit-negative { color: #e74c3c; font-weight: 700; }
        
        .day-bookings-modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 2500; align-items: center; justify-content: center; padding: 20px; }
        .day-bookings-modal.show { display: flex; }
        .day-bookings-content { background: white; border-radius: 15px; padding: 30px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; }
        
        .editable { 
            cursor: pointer; 
            padding: 4px 8px; 
            border-radius: 4px; 
            transition: all 0.2s;
            border: 1px dashed transparent;
        }
        .editable:hover { 
            background: #fff3cd; 
            border-color: #f39c12;
            transform: scale(1.05);
        }
        
        /* ë™ê¸°í™” ìƒíƒœ í‘œì‹œ */
        .sync-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            z-index: 9999;
            transition: all 0.3s;
        }
        .sync-status.syncing { background: #fff3cd; color: #856404; }
        .sync-status.success { background: #d4edda; color: #155724; }
        .sync-status.error { background: #f8d7da; color: #721c24; }
        
        /* â­ ë¡œê·¸ì¸ í™”ë©´ */
        .login-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, #00AEEF 0%, #0088CC 100%);
            z-index: 99999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .login-overlay.hidden { display: none; }
        .login-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 400px;
            width: 100%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .login-box h2 {
            font-size: 24px;
            color: #333;
            margin-bottom: 8px;
        }
        .login-box .subtitle {
            color: #666;
            font-size: 14px;
            margin-bottom: 30px;
        }
        .login-box .logo {
            font-size: 60px;
            margin-bottom: 20px;
        }
        .login-input {
            width: 100%;
            padding: 16px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            margin-bottom: 16px;
            text-align: center;
        }
        .login-input:focus {
            outline: none;
            border-color: #00AEEF;
        }
        .login-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #00AEEF 0%, #0088CC 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
        }
        .login-error {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 12px;
            display: none;
        }
        .logout-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background: rgba(0,0,0,0.1);
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            z-index: 9998;
        }
    </style>
</head>
<body>
    <!-- â­ ë¡œê·¸ì¸ í™”ë©´ -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-box">
            <div class="logo">ğŸ”</div>
            <h2>ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
            <p class="subtitle">(ì£¼)í™ˆì¼€ì–´ ê¹¨ë—í•œì§‘</p>
            <input type="password" class="login-input" id="adminPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" maxlength="20">
            <button class="login-btn" onclick="doAdminLogin()">ë¡œê·¸ì¸</button>
            <div class="login-error" id="loginError">ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤</div>
        </div>
    </div>
    
    <!-- ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ -->
    <button class="logout-btn" id="logoutBtn" style="display: none;" onclick="doAdminLogout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>

    <!-- ë™ê¸°í™” ìƒíƒœ í‘œì‹œ -->
    <div class="sync-status" id="syncStatus" style="display: none;"></div>

    <div class="header">
        <h1>ğŸ  (ì£¼)í™ˆì¼€ì–´ ê¹¨ë—í•œì§‘ - ê´€ë¦¬ì</h1>
        <p>ì»¨íŠ¸ë¡¤íƒ€ì›Œ v2.0</p>
        <div>
            <button class="action-btn" onclick="location.reload()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            <button class="action-btn" onclick="exportExcel()">ğŸ“Š ì—‘ì…€</button>
            <button class="action-btn" onclick="showBigCalendar()">ğŸ“… ìº˜ë¦°ë”</button>
            <a href="analytics_dashboard_final.html" class="action-btn" style="text-decoration: none; display: inline-block;">ğŸ“ˆ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</a>
        </div>
    </div>

    <div class="stats">
        <div class="stat-card"><div class="stat-number" id="totalCount">0</div><div class="stat-label">ì „ì²´ ì˜ˆì•½</div></div>
        <div class="stat-card"><div class="stat-number" id="receivedCount">0</div><div class="stat-label">ì‹ ê·œì˜ˆì•½</div></div>
        <div class="stat-card"><div class="stat-number" id="confirmedCount">0</div><div class="stat-label">ì˜ˆì•½í™•ì •</div></div>
        <div class="stat-card"><div class="stat-number" id="startedCount">0</div><div class="stat-label">ì‘ì—…ì‹œì‘</div></div>
        <div class="stat-card"><div class="stat-number" id="completedCount">0</div><div class="stat-label">ì‘ì—…ì™„ë£Œ</div></div>
        <div class="stat-card"><div class="stat-number" id="paidCount">0</div><div class="stat-label">ì…ê¸ˆì™„ë£Œ</div></div>
    </div>

    <div class="section">
        <div class="section-header">
            <h2>ğŸ‘¥ ë§¤ë‹ˆì € ê´€ë¦¬</h2>
            <div>
                <button class="btn btn-primary" onclick="toggleMgr()">í¼ì¹˜ê¸°/ì ‘ê¸°</button>
                <button class="btn btn-success" onclick="showAddModal()">+ ë§¤ë‹ˆì € ì¶”ê°€</button>
            </div>
        </div>
        <div class="manager-list" id="managerList" style="display: none;"></div>
    </div>

    <div class="section">
        <div class="section-header">
            <h2>ğŸ†• ì‹ ê·œì˜ˆì•½</h2>
            <button class="btn btn-primary" onclick="toggleNew()">í¼ì¹˜ê¸°/ì ‘ê¸°</button>
        </div>
        <div id="newBookingList" style="display: none;"></div>
    </div>

    <div class="section">
        <div class="section-header">
            <h2>ğŸ“‹ ì˜ˆì•½ ê´€ë¦¬</h2>
            <button class="btn btn-primary" onclick="toggleBook()">í¼ì¹˜ê¸°/ì ‘ê¸°</button>
        </div>
        <div id="bookingSection">
            <div style="margin-bottom: 20px;">
                <button class="filter-btn active" onclick="setFilter('all')">ì „ì²´</button>
                <button class="filter-btn" onclick="setFilter('confirmed')">ì˜ˆì•½í™•ì •</button>
                <button class="filter-btn" onclick="setFilter('scheduled')">ìŠ¤ì¼€ì¤„í”½ìŠ¤</button>
                <button class="filter-btn" onclick="setFilter('started')">ì‘ì—…ì‹œì‘</button>
                <button class="filter-btn" onclick="setFilter('completed')">ì‘ì—…ì™„ë£Œ</button>
                <button class="filter-btn" onclick="setFilter('paid')">ì…ê¸ˆì™„ë£Œ</button>
            </div>
            <div id="bookingList"></div>
        </div>
    </div>

    <div class="section">
        <div class="section-header">
            <h2>ğŸ’° ì¬ì •ê´€ë¦¬</h2>
            <button class="btn btn-primary" onclick="toggleFinance()">í¼ì¹˜ê¸°/ì ‘ê¸°</button>
        </div>
        <div id="financeSection" style="display: block;">
            <div style="overflow-x: auto;">
                <table class="finance-table" id="financeTable">
                    <thead>
                        <tr>
                            <th>ë²ˆí˜¸</th>
                            <th>ì ‘ìˆ˜ë‚ ì§œ</th>
                            <th>ì„œë¹„ìŠ¤ë‚ ì§œ</th>
                            <th>ì´ë¦„<br><small>ì „í™”/ì£¼ì†Œ</small></th>
                            <th>í‰í˜•</th>
                            <th>ì„œë¹„ìŠ¤</th>
                            <th>ë§¤ë‹ˆì €</th>
                            <th>ì‘ì—…í˜„í™©</th>
                            <th>ì´ë§¤ì¶œ<br><small>(ì›)</small></th>
                            <th>ë§¤ë‹ˆì €í˜ì´<br><small>(ì›)</small></th>
                            <th>ìˆœì´ìµ<br><small>(ì›)</small></th>
                            <th>ê²°ì œë°©ë²•</th>
                            <th>ì…ê¸ˆì¼</th>
                            <th>ë¯¸ìˆ˜ê¸ˆ<br><small>(ì›)</small></th>
                            <th>êµ¬ë¶„</th>
                            <th>ìˆ˜ì •</th>
                        </tr>
                    </thead>
                    <tbody id="financeBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ê°€ê²© ì„¤ì • ì„¹ì…˜ -->
    <div class="section">
        <div class="section-header">
            <h2>ğŸ’° ì•„íŒŒíŠ¸ ë‹¨ì§€ë³„ ê°€ê²© ì„¤ì •</h2>
            <button class="btn btn-success" onclick="showAddApartmentModal()">+ ìƒˆ ì•„íŒŒíŠ¸ ë‹¨ì§€ ì¶”ê°€</button>
        </div>
        <div id="apartmentPriceList"></div>
    </div>

    <!-- ì•„íŒŒíŠ¸ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
    <div class="modal" id="apartmentModal">
        <div class="modal-content">
            <h3 id="apartmentModalTitle">ğŸ˜ï¸ ì•„íŒŒíŠ¸ ë‹¨ì§€ ì¶”ê°€</h3>
            <div class="form-group">
                <label>ì•„íŒŒíŠ¸ ë‹¨ì§€ëª… *</label>
                <input type="text" id="apartmentName" placeholder="ì˜ˆ: ì†¡íŒŒ í—¬ë¦¬ì˜¤ì‹œí‹°">
            </div>
            <div class="form-group">
                <label>ê²€ìƒ‰ í‚¤ì›Œë“œ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
                <input type="text" id="apartmentKeywords" placeholder="ì˜ˆ: í—¬ë¦¬ì˜¤ì‹œí‹°, í—¬ë¦¬ì˜¤, ì†¡íŒŒí—¬ë¦¬ì˜¤">
            </div>
            <div class="form-group">
                <label>30í‰í˜• - ë‚œë°© (ì›)</label>
                <input type="number" id="price30heating" placeholder="120000">
            </div>
            <div class="form-group">
                <label>30í‰í˜• - ìˆ˜ë„ (ì›)</label>
                <input type="number" id="price30water" placeholder="120000">
            </div>
            <div class="form-group">
                <label>30í‰í˜• - ë‚œë°©+ìˆ˜ë„ (ì›)</label>
                <input type="number" id="price30both" placeholder="150000">
            </div>
            <div class="form-group">
                <label>40í‰í˜• - ë‚œë°© (ì›)</label>
                <input type="number" id="price40heating" placeholder="140000">
            </div>
            <div class="form-group">
                <label>40í‰í˜• - ìˆ˜ë„ (ì›)</label>
                <input type="number" id="price40water" placeholder="140000">
            </div>
            <div class="form-group">
                <label>40í‰í˜• - ë‚œë°©+ìˆ˜ë„ (ì›)</label>
                <input type="number" id="price40both" placeholder="180000">
            </div>
            <div class="form-group">
                <label>50í‰í˜• - ë‚œë°© (ì›)</label>
                <input type="number" id="price50heating" placeholder="160000">
            </div>
            <div class="form-group">
                <label>50í‰í˜• - ìˆ˜ë„ (ì›)</label>
                <input type="number" id="price50water" placeholder="160000">
            </div>
            <div class="form-group">
                <label>50í‰í˜• - ë‚œë°©+ìˆ˜ë„ (ì›)</label>
                <input type="number" id="price50both" placeholder="200000">
            </div>
            <div class="form-group">
                <label>60í‰í˜• - ë‚œë°© (ì›)</label>
                <input type="number" id="price60heating" placeholder="180000">
            </div>
            <div class="form-group">
                <label>60í‰í˜• - ìˆ˜ë„ (ì›)</label>
                <input type="number" id="price60water" placeholder="180000">
            </div>
            <div class="form-group">
                <label>60í‰í˜• - ë‚œë°©+ìˆ˜ë„ (ì›)</label>
                <input type="number" id="price60both" placeholder="220000">
            </div>
            <div class="modal-buttons">
                <button class="btn btn-danger" onclick="hideApartmentModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" id="saveApartmentBtn" onclick="saveApartment()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- ë§¤ë‹ˆì € ì¶”ê°€ ëª¨ë‹¬ -->
    <div class="modal" id="addManagerModal">
        <div class="modal-content">
            <h3>ğŸ‘¤ ë§¤ë‹ˆì € ì¶”ê°€</h3>
            <div class="form-group"><label>ì´ë¦„ *</label><input type="text" id="managerName"></div>
            <div class="form-group"><label>ì „í™”ë²ˆí˜¸ *</label><input type="tel" id="managerPhone" placeholder="010-0000-0000"></div>
            <div class="form-group"><label>ë¹„ë°€ë²ˆí˜¸ (ì„ íƒ, ë¯¸ì…ë ¥ì‹œ ì „í™”ë²ˆí˜¸ ë’¤ 4ìë¦¬)</label><input type="text" id="managerPassword" placeholder="ë¯¸ì…ë ¥ì‹œ ì „í™”ë²ˆí˜¸ ë’¤ 4ìë¦¬"></div>
            <div class="modal-buttons">
                <button class="btn btn-danger" onclick="hideAddModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="addMgr()">ì¶”ê°€</button>
            </div>
        </div>
    </div>

    <div class="confirm-modal" id="confirmModal">
        <div class="confirm-content">
            <h3 id="confirmMessage"></h3>
            <div class="confirm-buttons">
                <button onclick="confirmCancel()" style="background: #95a5a6; color: white;">ì·¨ì†Œ</button>
                <button onclick="confirmOk()" style="background: #e74c3c; color: white;">í™•ì¸</button>
            </div>
        </div>
    </div>

    <div class="calendar-modal-large" id="bigCalendarModal">
        <div class="calendar-big-container">
            <div class="calendar-big-header">
                <button class="calendar-big-nav-btn" onclick="prevBigMonth()">â—€ ì´ì „</button>
                <div class="calendar-big-title" id="bigCalendarTitle">2025ë…„ 1ì›”</div>
                <button class="calendar-big-nav-btn" onclick="nextBigMonth()">ë‹¤ìŒ â–¶</button>
            </div>
            <div class="calendar-big-weekdays">
                <div class="calendar-big-weekday">ì¼</div>
                <div class="calendar-big-weekday">ì›”</div>
                <div class="calendar-big-weekday">í™”</div>
                <div class="calendar-big-weekday">ìˆ˜</div>
                <div class="calendar-big-weekday">ëª©</div>
                <div class="calendar-big-weekday">ê¸ˆ</div>
                <div class="calendar-big-weekday">í† </div>
            </div>
            <div class="calendar-big-days" id="bigCalendarDays"></div>
            <button class="calendar-close-btn" onclick="hideBigCalendar()">ë‹«ê¸°</button>
        </div>
    </div>

    <div class="calendar-modal-large" id="managerCalendarModal">
        <div class="calendar-big-container">
            <h2 style="margin-bottom: 20px; color: #2c3e50;" id="managerCalendarName"></h2>
            <div class="calendar-big-header">
                <button class="calendar-big-nav-btn" onclick="prevManagerMonth()">â—€ ì´ì „</button>
                <div class="calendar-big-title" id="managerCalendarTitle">2025ë…„ 1ì›”</div>
                <button class="calendar-big-nav-btn" onclick="nextManagerMonth()">ë‹¤ìŒ â–¶</button>
            </div>
            <div class="calendar-big-weekdays">
                <div class="calendar-big-weekday">ì¼</div>
                <div class="calendar-big-weekday">ì›”</div>
                <div class="calendar-big-weekday">í™”</div>
                <div class="calendar-big-weekday">ìˆ˜</div>
                <div class="calendar-big-weekday">ëª©</div>
                <div class="calendar-big-weekday">ê¸ˆ</div>
                <div class="calendar-big-weekday">í† </div>
            </div>
            <div class="calendar-big-days" id="managerCalendarDays"></div>
            <button class="calendar-close-btn" onclick="hideManagerCalendar()">ë‹«ê¸°</button>
        </div>
    </div>

    <div class="day-bookings-modal" id="dayBookingsModal">
        <div class="day-bookings-content">
            <h2 style="margin-bottom: 20px; color: #2c3e50;" id="dayBookingsTitle"></h2>
            <div id="dayBookingsList"></div>
            <button class="calendar-close-btn" onclick="hideDayBookings()">ë‹«ê¸°</button>
        </div>
    </div>

    <script>
        // âš ï¸ Google Apps Script ë°°í¬ URL
        var GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxRKOfqpoMwV_PGWFOt-O32i1cz9ZKH9SJutoJ9q8au6GwBQ72PyY7aEtVOrSawltBLBA/exec';

        // â­ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ (ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ì„œë²„ì—ì„œ ê²€ì¦)
        const ADMIN_PASSWORD = 'homecare2024';  // ì›í•˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¡œ ë³€ê²½í•˜ì„¸ìš”
        const LOGIN_EXPIRY_HOURS = 24;  // 24ì‹œê°„ í›„ ìë™ ë¡œê·¸ì•„ì›ƒ
        
        // â­ ë¡œê·¸ì¸ ì²´í¬
        function checkAdminLogin() {
            const loginData = localStorage.getItem('adminLogin');
            if (loginData) {
                const data = JSON.parse(loginData);
                const now = new Date().getTime();
                if (now < data.expiry) {
                    // ë¡œê·¸ì¸ ìœ íš¨
                    document.getElementById('loginOverlay').classList.add('hidden');
                    document.getElementById('logoutBtn').style.display = 'block';
                    return true;
                } else {
                    // ë§Œë£Œë¨
                    localStorage.removeItem('adminLogin');
                }
            }
            return false;
        }
        
        // â­ ë¡œê·¸ì¸ ì‹¤í–‰
        function doAdminLogin() {
            const password = document.getElementById('adminPassword').value;
            
            if (password === ADMIN_PASSWORD) {
                const expiry = new Date().getTime() + (LOGIN_EXPIRY_HOURS * 60 * 60 * 1000);
                localStorage.setItem('adminLogin', JSON.stringify({ expiry: expiry }));
                
                document.getElementById('loginOverlay').classList.add('hidden');
                document.getElementById('logoutBtn').style.display = 'block';
                document.getElementById('loginError').style.display = 'none';
                
                // ë°ì´í„° ë¡œë“œ
                loadMgrs();
                loadBooks();
                loadApartmentPrices();
            } else {
                document.getElementById('loginError').style.display = 'block';
                document.getElementById('adminPassword').value = '';
            }
        }
        
        // â­ ë¡œê·¸ì•„ì›ƒ
        function doAdminLogout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('adminLogin');
                document.getElementById('loginOverlay').classList.remove('hidden');
                document.getElementById('logoutBtn').style.display = 'none';
                document.getElementById('adminPassword').value = '';
            }
        }
        
        // ì—”í„°í‚¤ ë¡œê·¸ì¸
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('adminPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') doAdminLogin();
            });
            
            // ë¡œê·¸ì¸ ì²´í¬ - ì´ë¯¸ ë¡œê·¸ì¸ë˜ì–´ ìˆìœ¼ë©´ ë°ì´í„° ë¡œë“œ
            if (checkAdminLogin()) {
                // ë°ì´í„°ëŠ” DOMContentLoadedì—ì„œ ë¡œë“œë¨
            }
        });

        // â­ XSS ë°©ì§€ìš© HTML ì´ìŠ¤ì¼€ì´í”„ í•¨ìˆ˜
        function escapeHtml(unsafe) {
            if (unsafe === null || unsafe === undefined) return '';
            return String(unsafe)
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
        
        // â­ fetch íƒ€ì„ì•„ì›ƒ ë˜í¼ (30ì´ˆ)
        async function fetchWithTimeout(url, options = {}, timeout = 30000) {
            const controller = new AbortController();
            const timeoutId = setTimeout(function() { controller.abort(); }, timeout);
            
            try {
                var response = await fetch(url, {
                    ...options,
                    signal: controller.signal
                });
                clearTimeout(timeoutId);
                return response;
            } catch (error) {
                clearTimeout(timeoutId);
                if (error.name === 'AbortError') {
                    throw new Error('ì„œë²„ ì‘ë‹µ ì‹œê°„ ì´ˆê³¼ (30ì´ˆ)');
                }
                throw error;
            }
        }
        
        var bookings = [];
        var managers = [];  // â­ ì´ì œ APIì—ì„œ ë¡œë“œ
        var curFilter = 'all';
        var mgrOpen = false;
        var newOpen = false;
        var bookOpen = true;
        var financeOpen = true;
        var confirmCallback = null;
        var bigCalYear = new Date().getFullYear();
        var bigCalMonth = new Date().getMonth();
        var mgrCalYear = new Date().getFullYear();
        var mgrCalMonth = new Date().getMonth();
        var selectedManager = '';
        
        var lastBookingsHash = '';
        var lastManagersHash = '';

        var priceTable = {
            '30í‰í˜•(20í‰í˜• í¬í•¨)': { 'ìˆ˜ë„ê´€ ìŠ¤ì¼€ì¼ë§': 150000, 'ë‚œë°©ê´€ ìŠ¤ì¼€ì¼ë§': 210000, 'ìˆ˜ë„ê´€+ë‚œë°©ê´€ ìŠ¤ì¼€ì¼ë§': 280000 },
            '40í‰í˜•': { 'ìˆ˜ë„ê´€ ìŠ¤ì¼€ì¼ë§': 180000, 'ë‚œë°©ê´€ ìŠ¤ì¼€ì¼ë§': 250000, 'ìˆ˜ë„ê´€+ë‚œë°©ê´€ ìŠ¤ì¼€ì¼ë§': 320000 },
            '50í‰í˜•': { 'ìˆ˜ë„ê´€ ìŠ¤ì¼€ì¼ë§': 210000, 'ë‚œë°©ê´€ ìŠ¤ì¼€ì¼ë§': 290000, 'ìˆ˜ë„ê´€+ë‚œë°©ê´€ ìŠ¤ì¼€ì¼ë§': 360000 },
            '60í‰í˜•': { 'ìˆ˜ë„ê´€ ìŠ¤ì¼€ì¼ë§': 250000, 'ë‚œë°©ê´€ ìŠ¤ì¼€ì¼ë§': 330000, 'ìˆ˜ë„ê´€+ë‚œë°©ê´€ ìŠ¤ì¼€ì¼ë§': 400000 }
        };

        var MANAGER_COST = 130000;

        // ========================================
        // ë™ê¸°í™” ìƒíƒœ í‘œì‹œ
        // ========================================
        function showSyncStatus(status, message) {
            var el = document.getElementById('syncStatus');
            el.textContent = message;
            el.className = 'sync-status ' + status;
            el.style.display = 'block';
            
            if (status === 'success' || status === 'error') {
                setTimeout(function() {
                    el.style.display = 'none';
                }, 3000);
            }
        }

        // ========================================
        // ê°€ê²© ê´€ë ¨ í•¨ìˆ˜ë“¤
        // ========================================
        function getPrice(size, service) {
            var priceMatch = service.match(/\(([0-9,]+)ì›\)/);
            if (priceMatch) {
                return parseInt(priceMatch[1].replace(/,/g, ''));
            }
            
            if (size) {
                priceMatch = size.match(/\(([0-9,]+)ì›\)/);
                if (priceMatch) {
                    return parseInt(priceMatch[1].replace(/,/g, ''));
                }
            }
            
            if (size && service && priceTable[size] && priceTable[size][service]) {
                return priceTable[size][service];
            }
            
            return 0;
        }

        function extractSize(fullSize, fullService) {
            var match;  // â­ í•œ ë²ˆë§Œ ì„ ì–¸
            if (fullSize) {
                match = fullSize.match(/(\d+)í‰í˜•/);
                if (match) return match[1] + 'í‰';
            }
            if (fullService) {
                match = fullService.match(/(\d+)í‰í˜•/);
                if (match) return match[1] + 'í‰';
            }
            return '-';
        }

        function extractService(fullService) {
            if (!fullService || fullService === '') return '-';
            return fullService.replace(/\s*\([^)]*\)/g, '').trim();
        }

        // ========================================
        // í™•ì¸ ëª¨ë‹¬
        // ========================================
        function showConfirm(message, callback) {
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmModal').classList.add('show');
            confirmCallback = callback;
        }

        function confirmOk() {
            document.getElementById('confirmModal').classList.remove('show');
            if (confirmCallback) confirmCallback(true);
            confirmCallback = null;
        }

        function confirmCancel() {
            document.getElementById('confirmModal').classList.remove('show');
            if (confirmCallback) confirmCallback(false);
            confirmCallback = null;
        }

        // ========================================
        // â­ ë§¤ë‹ˆì € ê´€ë¦¬ - API ì—°ë™ìœ¼ë¡œ ë³€ê²½!
        // ========================================
        async function loadMgrs() {
            ');
            
            try {
                var response = await fetch(GOOGLE_SCRIPT_URL + '?action=getManagers');
                var result = await response.json();
                
                if (result.success && result.managers) {
                    managers = result.managers;
                    
                    renderMgrs();
                } else {
                    
                    managers = [];
                    renderMgrs();
                }
            } catch (error) {
                
                managers = [];
                renderMgrs();
            }
        }

        function renderMgrs() {
            var div = document.getElementById('managerList');
            var currentHash = JSON.stringify(managers);
            
            if (currentHash === lastManagersHash && div.children.length > 0) {
                return;
            }
            lastManagersHash = currentHash;
            
            if (managers.length === 0) {
                div.innerHTML = '<p style="color: #999; text-align: center; padding: 40px;">ë“±ë¡ëœ ë§¤ë‹ˆì €ê°€ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }
            
            div.innerHTML = '';
            for (var i = 0; i < managers.length; i++) {
                var mgr = managers[i];
                var card = document.createElement('div');
                card.className = 'manager-card';
                
                var btn = document.createElement('button');
                btn.className = 'manager-remove-btn';
                btn.textContent = 'Ã—';
                btn.style.right = '50px';
                btn.onclick = (function(m) {
                    return function(e) {
                        e.stopPropagation();
                        deleteManager(m.id, m.name);
                    };
                })(mgr);
                
                var editBtn = document.createElement('button');
                editBtn.className = 'manager-remove-btn';
                editBtn.textContent = 'âœ';
                editBtn.style.background = '#3498db';
                editBtn.style.right = '10px';
                editBtn.onclick = (function(m) {
                    return function(e) {
                        e.stopPropagation();
                        editManager(m);
                    };
                })(mgr);
                
                var nameDiv = document.createElement('div');
                nameDiv.className = 'manager-name';
                nameDiv.textContent = 'ğŸ‘¤ ' + mgr.name;
                
                var infoDiv = document.createElement('div');
                infoDiv.style.fontSize = '13px';
                infoDiv.style.color = '#666';
                infoDiv.textContent = 'ğŸ“ ' + (mgr.phone || 'ì „í™”ë²ˆí˜¸ ì—†ìŒ');
                
                var subDiv = document.createElement('div');
                subDiv.style.fontSize = '12px';
                subDiv.style.color = '#999';
                subDiv.style.marginTop = '5px';
                subDiv.textContent = 'í´ë¦­í•˜ì—¬ ìº˜ë¦°ë” ë³´ê¸°';
                
                card.onclick = (function(name) {
                    return function() {
                        showManagerCalendar(name);
                    };
                })(mgr.name);
                
                card.appendChild(btn);
                card.appendChild(editBtn);
                card.appendChild(nameDiv);
                card.appendChild(infoDiv);
                card.appendChild(subDiv);
                div.appendChild(card);
            }
        }

        function showAddModal() {
            document.getElementById('managerName').value = '';
            document.getElementById('managerPhone').value = '';
            document.getElementById('managerPassword').value = '';
            document.getElementById('addManagerModal').classList.add('show');
        }

        function hideAddModal() {
            document.getElementById('addManagerModal').classList.remove('show');
        }

        // â­ ë§¤ë‹ˆì € ì¶”ê°€ - API ì—°ë™
        async function addMgr() {
            var name = document.getElementById('managerName').value.trim();
            var phone = document.getElementById('managerPhone').value.trim();
            var password = document.getElementById('managerPassword').value.trim();

            if (!name || !phone) {
                alert('ì´ë¦„ê³¼ ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            var confirmMsg = 'ìƒˆ ë§¤ë‹ˆì €ë¥¼ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ë¦„: ' + name + '\nì „í™”ë²ˆí˜¸: ' + phone;
            if (password) {
                confirmMsg += '\në¹„ë°€ë²ˆí˜¸: ' + password;
            } else {
                confirmMsg += '\në¹„ë°€ë²ˆí˜¸: ' + phone.slice(-4) + ' (ì „í™”ë²ˆí˜¸ ë’¤ 4ìë¦¬)';
            }
            
            showConfirm(confirmMsg, async function(result) {
                if (!result) return;
                
                showSyncStatus('syncing', 'ğŸ”„ ë§¤ë‹ˆì € ì¶”ê°€ ì¤‘...');
                
                try {
                    var response = await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'addManager',
                            name: name,
                            phone: phone,
                            password: password || phone.slice(-4)
                        })
                    });
                    
                    var apiResult = await response.json();
                    
                    if (apiResult.success) {
                        showSyncStatus('success', 'âœ… ë§¤ë‹ˆì € ì¶”ê°€ ì™„ë£Œ');
                        hideAddModal();
                        if (!mgrOpen) toggleMgr();
                        await loadMgrs();
                        alert('âœ… ' + name + ' ë§¤ë‹ˆì €ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!\n\në¹„ë°€ë²ˆí˜¸: ' + (password || phone.slice(-4)));
                    } else {
                        showSyncStatus('error', 'âŒ ì¶”ê°€ ì‹¤íŒ¨');
                        alert('âŒ ë§¤ë‹ˆì € ì¶”ê°€ ì‹¤íŒ¨: ' + apiResult.message);
                    }
                } catch (error) {
                    showSyncStatus('error', 'âŒ ì„œë²„ ì˜¤ë¥˜');
                    
                    alert('âŒ ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            });
        }

        // â­ ë§¤ë‹ˆì € ìˆ˜ì • - API ì—°ë™
        async function editManager(mgr) {
            var newPhone = prompt('ì „í™”ë²ˆí˜¸:', mgr.phone);
            if (newPhone === null) return;
            
            var newPassword = prompt('ìƒˆ ë¹„ë°€ë²ˆí˜¸ (ë³€ê²½í•˜ì§€ ì•Šìœ¼ë ¤ë©´ ë¹„ì›Œë‘ì„¸ìš”):');
            if (newPassword === null) return;
            
            var confirmMsg = 'ë§¤ë‹ˆì € ì •ë³´ë¥¼ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ë¦„: ' + mgr.name + '\nì „í™”ë²ˆí˜¸: ' + mgr.phone + ' â†’ ' + newPhone;
            if (newPassword) {
                confirmMsg += '\në¹„ë°€ë²ˆí˜¸: ë³€ê²½ë¨';
            }
            
            showConfirm(confirmMsg, async function(result) {
                if (!result) return;
                
                showSyncStatus('syncing', 'ğŸ”„ ë§¤ë‹ˆì € ìˆ˜ì • ì¤‘...');
                
                try {
                    var updateData = {
                        action: 'updateManager',
                        id: mgr.id,
                        phone: newPhone
                    };
                    
                    if (newPassword) {
                        updateData.password = newPassword;
                    }
                    
                    var response = await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(updateData)
                    });
                    
                    var apiResult = await response.json();
                    
                    if (apiResult.success) {
                        showSyncStatus('success', 'âœ… ìˆ˜ì • ì™„ë£Œ');
                        await loadMgrs();
                        alert('âœ… ë§¤ë‹ˆì € ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    } else {
                        showSyncStatus('error', 'âŒ ìˆ˜ì • ì‹¤íŒ¨');
                        alert('âŒ ìˆ˜ì • ì‹¤íŒ¨: ' + apiResult.message);
                    }
                } catch (error) {
                    showSyncStatus('error', 'âŒ ì„œë²„ ì˜¤ë¥˜');
                    
                    alert('âŒ ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            });
        }

        // â­ ë§¤ë‹ˆì € ì‚­ì œ - API ì—°ë™
        async function deleteManager(id, name) {
            showConfirm('ì •ë§ë¡œ "' + name + '" ë§¤ë‹ˆì €ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', async function(result) {
                if (!result) return;
                
                showSyncStatus('syncing', 'ğŸ”„ ë§¤ë‹ˆì € ì‚­ì œ ì¤‘...');
                
                try {
                    var response = await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'deleteManager',
                            id: id
                        })
                    });
                    
                    var apiResult = await response.json();
                    
                    if (apiResult.success) {
                        showSyncStatus('success', 'âœ… ì‚­ì œ ì™„ë£Œ');
                        lastManagersHash = '';
                        await loadMgrs();
                        alert('âœ… ë§¤ë‹ˆì €ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    } else {
                        showSyncStatus('error', 'âŒ ì‚­ì œ ì‹¤íŒ¨');
                        alert('âŒ ì‚­ì œ ì‹¤íŒ¨: ' + apiResult.message);
                    }
                } catch (error) {
                    showSyncStatus('error', 'âŒ ì„œë²„ ì˜¤ë¥˜');
                    
                    alert('âŒ ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            });
        }

        function showManagerCalendar(name) {
            selectedManager = name;
            document.getElementById('managerCalendarName').textContent = 'ğŸ‘¤ ' + name + 'ë‹˜ì˜ ì¼ì •';
            document.getElementById('managerCalendarModal').classList.add('show');
            mgrCalYear = new Date().getFullYear();
            mgrCalMonth = new Date().getMonth();
            renderManagerCalendar();
        }

        function hideManagerCalendar() {
            document.getElementById('managerCalendarModal').classList.remove('show');
        }

        function prevManagerMonth() {
            mgrCalMonth--;
            if (mgrCalMonth < 0) { mgrCalMonth = 11; mgrCalYear--; }
            renderManagerCalendar();
        }

        function nextManagerMonth() {
            mgrCalMonth++;
            if (mgrCalMonth > 11) { mgrCalMonth = 0; mgrCalYear++; }
            renderManagerCalendar();
        }

        function renderManagerCalendar() {
            var monthNames = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
            document.getElementById('managerCalendarTitle').textContent = mgrCalYear + 'ë…„ ' + monthNames[mgrCalMonth];

            var firstDay = new Date(mgrCalYear, mgrCalMonth, 1).getDay();
            var daysInMonth = new Date(mgrCalYear, mgrCalMonth + 1, 0).getDate();

            var container = document.getElementById('managerCalendarDays');
            container.innerHTML = '';

            for (var i = 0; i < firstDay; i++) {
                var empty = document.createElement('div');
                empty.className = 'calendar-big-day empty';
                container.appendChild(empty);
            }

            for (var day = 1; day <= daysInMonth; day++) {
                var dateStr = mgrCalYear + '-' + String(mgrCalMonth + 1).padStart(2, '0') + '-' + String(day).padStart(2, '0');
                var dayBookings = bookings.filter(function(b) { 
                    return b.serviceDate === dateStr && b.manager === selectedManager; 
                });

                var dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-big-day';
                
                var numDiv = document.createElement('div');
                numDiv.className = 'calendar-big-day-number';
                numDiv.textContent = day;
                dayDiv.appendChild(numDiv);

                if (dayBookings.length > 0) {
                    dayDiv.classList.add('has-bookings');
                    var countDiv = document.createElement('div');
                    countDiv.className = 'calendar-booking-count';
                    countDiv.textContent = dayBookings.length + 'ê±´';
                    dayDiv.appendChild(countDiv);

                    dayDiv.onclick = (function(date, bks) {
                        return function() { showDayBookings(date, bks); };
                    })(dateStr, dayBookings);
                }

                container.appendChild(dayDiv);
            }
        }

        function showDayBookings(date, dayBookings) {
            document.getElementById('dayBookingsTitle').textContent = 'ğŸ“… ' + date + ' ì˜ˆì•½ (' + dayBookings.length + 'ê±´)';
            
            var list = document.getElementById('dayBookingsList');
            list.innerHTML = '';
            
            for (var i = 0; i < dayBookings.length; i++) {
                var b = dayBookings[i];
                var card = document.createElement('div');
                card.className = 'booking-card';
                card.style.marginBottom = '15px';
                
                card.innerHTML = '<div class="customer-name">' + escapeHtml(b.name) + '</div>' +
                    '<div class="info-item">ğŸ“ ' + escapeHtml(b.phone) + '</div>' +
                    '<div class="info-item">ğŸ“ ' + escapeHtml(b.address) + '</div>' +
                    '<div class="info-item">ğŸ  ' + escapeHtml(b.service || b.items || '') + '</div>';
                
                list.appendChild(card);
            }
            
            document.getElementById('dayBookingsModal').classList.add('show');
        }

        function hideDayBookings() {
            document.getElementById('dayBookingsModal').classList.remove('show');
        }

        function toggleMgr() {
            mgrOpen = !mgrOpen;
            document.getElementById('managerList').style.display = mgrOpen ? 'grid' : 'none';
        }

        function toggleNew() {
            newOpen = !newOpen;
            document.getElementById('newBookingList').style.display = newOpen ? 'block' : 'none';
        }

        function toggleBook() {
            bookOpen = !bookOpen;
            document.getElementById('bookingSection').style.display = bookOpen ? 'block' : 'none';
        }

        function toggleFinance() {
            financeOpen = !financeOpen;
            document.getElementById('financeSection').style.display = financeOpen ? 'block' : 'none';
        }

        // ========================================
        // ì˜ˆì•½ ë¡œë“œ (API)
        // ========================================
        async function loadBooks() {
            ');
            
            try {
                var response = await fetch(GOOGLE_SCRIPT_URL + '?action=getBookings');
                var result = await response.json();
                
                if (result.success && result.bookings) {
                    bookings = result.bookings;
                    
                    
                    // ìŠ¤ë§ˆíŠ¸ ì •ë ¬
                    bookings.sort(function(a, b) {
                        var dateA = a.serviceDate || '9999-12-31';
                        var dateB = b.serviceDate || '9999-12-31';
                        if (dateA !== dateB) return dateA.localeCompare(dateB);
                        
                        var timeOrderA = getTimeSlotOrder(a.timeSlots);
                        var timeOrderB = getTimeSlotOrder(b.timeSlots);
                        if (timeOrderA !== timeOrderB) return timeOrderA - timeOrderB;
                        
                        var aptA = extractApartmentName(a.address);
                        var aptB = extractApartmentName(b.address);
                        if (aptA !== aptB) return aptA.localeCompare(aptB);
                        
                        var dongA = extractDongNumber(a.address);
                        var dongB = extractDongNumber(b.address);
                        return dongA - dongB;
                    });
                    
                    renderNewBooks();
                    renderBooks();
                    renderFinance();
                    updateStats();
                } else {
                    
                }
            } catch (error) {
                
            }
        }
        
        function getTimeSlotOrder(timeSlots) {
            if (!timeSlots || timeSlots.length === 0) return 999;
            var slot = timeSlots[0];
            if (slot.indexOf('ì˜¤ì „') !== -1 || slot.indexOf('9') !== -1) return 1;
            if (slot.indexOf('ì˜¤í›„ 1') !== -1 || slot.indexOf('13') !== -1) return 2;
            if (slot.indexOf('ì˜¤í›„ 4') !== -1 || slot.indexOf('16') !== -1) return 3;
            if (slot.indexOf('ì¢…ì¼') !== -1) return 0;
            return 999;
        }
        
        function extractApartmentName(address) {
            if (!address) return '';
            var aptMatch = address.match(/([ê°€-í£A-Za-z0-9]+(?:ì•„íŒŒíŠ¸|APT|ë¹Œë¼|íƒ€ì›Œ|íŒ°ë¦¬ìŠ¤))/i);
            if (aptMatch) return aptMatch[1];
            var parts = address.split(' ');
            return parts.length >= 2 ? parts[1] : '';
        }
        
        function extractDongNumber(address) {
            if (!address) return 999999;
            var dongMatch = address.match(/(\d+)ë™/);
            if (dongMatch) return parseInt(dongMatch[1]);
            return 999999;
        }

        function renderNewBooks() {
            var div = document.getElementById('newBookingList');
            var newBookings = bookings.filter(function(b) { 
                return b.status === 'received' && b.assignmentSent !== true; 
            });

            if (newBookings.length === 0) {
                div.innerHTML = '<p style="color: #999; text-align: center; padding: 40px;">ì‹ ê·œì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }

            div.innerHTML = '';
            for (var i = 0; i < newBookings.length; i++) {
                var b = newBookings[i];
                renderBookingCard(b, div);
            }
        }

        // â­ í˜ì´ì§€ë„¤ì´ì…˜ ì„¤ì •
        var ITEMS_PER_PAGE = 50;
        var currentPage = 1;

        function setFilter(filter) {
            curFilter = filter;
            currentPage = 1;  // í•„í„° ë³€ê²½ ì‹œ í˜ì´ì§€ ë¦¬ì…‹
            var btns = document.querySelectorAll('.filter-btn');
            for (var i = 0; i < btns.length; i++) btns[i].classList.remove('active');
            event.target.classList.add('active');
            renderBooks();
        }

        function renderBooks() {
            var div = document.getElementById('bookingList');
            
            var filtered = bookings.filter(function(b) { 
                return b.status !== 'received' && (curFilter === 'all' || b.status === curFilter);
            });

            if (filtered.length === 0) {
                div.innerHTML = '<p style="color: #999; text-align: center; padding: 40px;">ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }
            
            // â­ í˜ì´ì§€ë„¤ì´ì…˜
            var displayCount = currentPage * ITEMS_PER_PAGE;
            var displayFiltered = filtered.slice(0, displayCount);
            var hasMore = filtered.length > displayCount;
                div.innerHTML = '<p style="color: #999; text-align: center; padding: 40px;">ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤</p>';
                return;
            }

            var groupedByDate = {};
            displayFiltered.forEach(function(booking) {
                var date = booking.serviceDate || 'ë‚ ì§œë¯¸ì •';
                if (!groupedByDate[date]) groupedByDate[date] = [];
                groupedByDate[date].push(booking);
            });

            var sortedDates = Object.keys(groupedByDate).sort();
            var today = new Date();
            var todayStr = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0') + '-' + String(today.getDate()).padStart(2, '0');

            div.innerHTML = '';
            
            sortedDates.forEach(function(date) {
                var bookingsOnDate = groupedByDate[date];
                
                var dateHeader = document.createElement('div');
                dateHeader.style.cssText = 'background: linear-gradient(135deg, #00AEEF 0%, #0088CC 100%); color: white; padding: 15px 20px; border-radius: 12px; margin-bottom: 15px; margin-top: 20px; font-size: 18px; font-weight: 800; display: flex; justify-content: space-between; align-items: center;';
                
                var dateText = document.createElement('span');
                if (date === todayStr) {
                    dateText.textContent = 'ğŸ“… ì˜¤ëŠ˜ (' + formatDateKorean(date) + ')';
                    dateHeader.style.background = 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)';
                } else if (date === getDateString(1)) {
                    dateText.textContent = 'ğŸ“… ë‚´ì¼ (' + formatDateKorean(date) + ')';
                    dateHeader.style.background = 'linear-gradient(135deg, #f39c12 0%, #e67e22 100%)';
                } else {
                    dateText.textContent = 'ğŸ“… ' + formatDateKorean(date);
                }
                
                var countBadge = document.createElement('span');
                countBadge.textContent = bookingsOnDate.length + 'ê±´';
                countBadge.style.cssText = 'background: rgba(255,255,255,0.3); padding: 5px 15px; border-radius: 20px; font-size: 14px;';
                
                dateHeader.appendChild(dateText);
                dateHeader.appendChild(countBadge);
                div.appendChild(dateHeader);
                
                bookingsOnDate.forEach(function(booking) {
                    renderBookingCard(booking, div);
                });
            });
            
            // â­ ë”ë³´ê¸° ë²„íŠ¼
            if (hasMore) {
                var loadMoreBtn = document.createElement('button');
                loadMoreBtn.textContent = 'ğŸ“¥ ë”ë³´ê¸° (' + (filtered.length - displayCount) + 'ê±´ ë‚¨ìŒ)';
                loadMoreBtn.style.cssText = 'display: block; width: 100%; padding: 16px; margin-top: 20px; background: #f8f9fa; border: 2px dashed #ddd; border-radius: 12px; font-size: 16px; font-weight: 600; color: #666; cursor: pointer;';
                loadMoreBtn.onclick = function() {
                    currentPage++;
                    renderBooks();
                };
                div.appendChild(loadMoreBtn);
            } else if (filtered.length > ITEMS_PER_PAGE) {
                var endMsg = document.createElement('div');
                endMsg.style.cssText = 'text-align: center; padding: 20px; color: #999; font-size: 14px;';
                endMsg.textContent = 'âœ… ëª¨ë“  ì˜ˆì•½ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤ (ì´ ' + filtered.length + 'ê±´)';
                div.appendChild(endMsg);
            }
        }

        function formatDateKorean(dateStr) {
            if (dateStr === 'ë‚ ì§œë¯¸ì •') return 'ë‚ ì§œë¯¸ì •';
            var parts = dateStr.split('-');
            return parts[0] + 'ë…„ ' + parseInt(parts[1]) + 'ì›” ' + parseInt(parts[2]) + 'ì¼';
        }

        function getDateString(daysOffset) {
            var date = new Date();
            date.setDate(date.getDate() + daysOffset);
            return date.getFullYear() + '-' + String(date.getMonth() + 1).padStart(2, '0') + '-' + String(date.getDate()).padStart(2, '0');
        }

        function renderBookingCard(b, container) {
            var statusNames = { 'received': 'ì˜ˆì•½ì ‘ìˆ˜', 'confirmed': 'ì˜ˆì•½í™•ì •', 'scheduled': 'ìŠ¤ì¼€ì¤„í”½ìŠ¤', 'started': 'ì‘ì—…ì‹œì‘', 'completed': 'ì‘ì—…ì™„ë£Œ', 'paid': 'ì…ê¸ˆì™„ë£Œ', 'cancelled': 'ì˜ˆì•½ì·¨ì†Œ' };
            var statusColors = { 'received': '#e67e22', 'confirmed': '#f39c12', 'scheduled': '#9b59b6', 'started': '#3498db', 'completed': '#27ae60', 'paid': '#1abc9c', 'cancelled': '#e74c3c' };

            var card = document.createElement('div');
            card.className = 'booking-card';
            
            var name = document.createElement('div');
            name.className = 'customer-name';
            name.textContent = b.name;
            card.appendChild(name);
            
            var info1 = document.createElement('div');
            info1.className = 'info-item';
            info1.textContent = 'ğŸ“ ' + b.phone;
            card.appendChild(info1);
            
            var info2 = document.createElement('div');
            info2.className = 'info-item';
            info2.textContent = 'ğŸ“ ' + b.address;
            card.appendChild(info2);
            
            var info3 = document.createElement('div');
            info3.className = 'info-item';
            info3.textContent = 'ğŸ  ' + (b.service || b.items || '');
            card.appendChild(info3);
            
            var info4 = document.createElement('div');
            info4.className = 'info-item';
            info4.textContent = 'ğŸ“… ' + (b.serviceDate || 'ë¯¸ì§€ì •');
            card.appendChild(info4);
            
            if (b.timeSlots && b.timeSlots.length > 0) {
                var info5 = document.createElement('div');
                info5.className = 'info-item';
                info5.style.cssText = 'background: #fff3cd; color: #856404; padding: 8px 12px; border-radius: 8px; font-weight: 600; margin-top: 8px;';
                info5.textContent = 'ğŸ• ê³ ê° í¬ë§: ' + b.timeSlots.join(', ');
                card.appendChild(info5);
            }
            
            if (b.actualStartTime) {
                var info6 = document.createElement('div');
                info6.className = 'info-item';
                info6.style.cssText = 'background: #d4edda; color: #155724; padding: 8px 12px; border-radius: 8px; font-weight: 700; margin-top: 8px;';
                info6.textContent = 'âœ… ì‹œì‘ ì‹œê°„: ' + b.actualStartTime + ' (ë§¤ë‹ˆì € í™•ì •)';
                card.appendChild(info6);
            }
            
            var badgeContainer = document.createElement('div');
            badgeContainer.style.margin = '12px 0';
            
            if (b.manager && b.manager !== 'ë¯¸ë°°ì •') {
                if (b.assignmentAccepted === true) {
                    var acceptBadge = document.createElement('div');
                    acceptBadge.style.cssText = 'background: #27ae60; color: white; padding: 8px 12px; border-radius: 20px; font-size: 13px; font-weight: 700; display: inline-block; margin: 8px 8px 8px 0;';
                    acceptBadge.textContent = 'âœ… ìˆ˜ë½ì™„ë£Œ';
                    badgeContainer.appendChild(acceptBadge);
                } else if (b.assignmentSent === true) {
                    var sentBadge = document.createElement('div');
                    sentBadge.style.cssText = 'background: #f39c12; color: white; padding: 8px 12px; border-radius: 20px; font-size: 13px; font-weight: 700; display: inline-block; margin: 8px 8px 8px 0;';
                    sentBadge.textContent = 'ğŸ“¤ ë°°ì •ì „ì†¡ë¨';
                    badgeContainer.appendChild(sentBadge);
                }
            }
            
            var statusBadge = document.createElement('span');
            statusBadge.className = 'status-badge';
            statusBadge.style.background = statusColors[b.status];
            statusBadge.style.color = 'white';
            statusBadge.textContent = statusNames[b.status];
            badgeContainer.appendChild(statusBadge);
            
            card.appendChild(badgeContainer);
            
            var actions = document.createElement('div');
            actions.className = 'booking-actions';
            
            // ë§¤ë‹ˆì € ì„ íƒ ë“œë¡­ë‹¤ìš´
            var select = document.createElement('select');
            select.style.padding = '10px';
            select.style.border = '2px solid #e0e0e0';
            select.style.borderRadius = '8px';
            
            var currentManager = b.manager || '';
            select.setAttribute('data-current-manager', currentManager);
            
            var opt0 = document.createElement('option');
            opt0.value = '';
            opt0.textContent = 'ë¯¸ë°°ì •';
            select.appendChild(opt0);
            
            for (var j = 0; j < managers.length; j++) {
                var opt = document.createElement('option');
                opt.value = managers[j].name;
                opt.textContent = managers[j].name;
                if (b.manager === managers[j].name) opt.selected = true;
                select.appendChild(opt);
            }
            
            select.onchange = (function(id, selectElement) {
                return function(e) {
                    var newValue = this.value;
                    var oldValue = this.getAttribute('data-current-manager');
                    if (newValue !== oldValue) {
                        updateManagerAssignment(id, newValue, selectElement);
                    }
                };
            })(b.id, select);
            actions.appendChild(select);
            
            // ë°°ì •ì „ì†¡ ë²„íŠ¼
            if (b.manager && b.manager !== 'ë¯¸ë°°ì •') {
                if (b.assignmentAccepted !== true && b.assignmentSent !== true) {
                    var assignBtn = document.createElement('button');
                    assignBtn.className = 'btn btn-success';
                    assignBtn.textContent = 'ğŸ“¤ ë°°ì •ì „ì†¡';
                    assignBtn.onclick = (function(id) {
                        return function() { sendAssign(id); };
                    })(b.id);
                    actions.appendChild(assignBtn);
                }
            }
            
            // ì…ê¸ˆì™„ë£Œ ë²„íŠ¼
            if (b.status === 'completed') {
                var paidBtn = document.createElement('button');
                paidBtn.className = 'btn';
                paidBtn.style.background = '#1abc9c';
                paidBtn.textContent = 'ğŸ’° ì…ê¸ˆì™„ë£Œ';
                paidBtn.onclick = (function(id, nm) {
                    return function() { markAsPaid(id, nm); };
                })(b.id, b.name);
                actions.appendChild(paidBtn);
            }
            
            // ìˆ˜ì • ë²„íŠ¼
            var editBtn = document.createElement('button');
            editBtn.className = 'btn btn-info';
            editBtn.textContent = 'ìˆ˜ì •';
            editBtn.onclick = (function(booking) {
                return function() { editBooking(booking); };
            })(b);
            actions.appendChild(editBtn);
            
            // ì‚­ì œ ë²„íŠ¼
            var delBtn = document.createElement('button');
            delBtn.className = 'btn btn-danger';
            delBtn.textContent = 'ì‚­ì œ';
            delBtn.onclick = (function(id, nm) {
                return function() { deleteBooking(id, nm); };
            })(b.id, b.name);
            actions.appendChild(delBtn);
            
            card.appendChild(actions);
            container.appendChild(card);
        }

        // â­ ë§¤ë‹ˆì € ë°°ì • - API ì—°ë™
        async function updateManagerAssignment(bookingId, managerName, selectElement) {
            var bookingName = '';
            for (var i = 0; i < bookings.length; i++) {
                if (bookings[i].id === bookingId) {
                    bookingName = bookings[i].name;
                    break;
                }
            }
            
            var oldManager = selectElement.getAttribute('data-current-manager');
            var confirmMsg = managerName ? 
                'ë§¤ë‹ˆì €ë¥¼ "' + managerName + '"ë‹˜ìœ¼ë¡œ ë°°ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nê³ ê°: ' + bookingName :
                'ë§¤ë‹ˆì € ë°°ì •ì„ í•´ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nê³ ê°: ' + bookingName;
            
            showConfirm(confirmMsg, async function(result) {
                if (!result) {
                    selectElement.value = oldManager;
                    return;
                }
                
                showSyncStatus('syncing', 'ğŸ”„ ë§¤ë‹ˆì € ë°°ì • ì¤‘...');
                
                try {
                    var response = await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'updateBooking',
                            id: bookingId,
                            manager: managerName,
                            assignmentSent: false,
                            assignmentAccepted: false
                        })
                    });
                    
                    var apiResult = await response.json();
                    
                    if (apiResult.success) {
                        showSyncStatus('success', 'âœ… ë°°ì • ì™„ë£Œ');
                        selectElement.setAttribute('data-current-manager', managerName);
                        
                        for (var i = 0; i < bookings.length; i++) {
                            if (bookings[i].id === bookingId) {
                                bookings[i].manager = managerName;
                                bookings[i].assignmentSent = false;
                                bookings[i].assignmentAccepted = false;
                                break;
                            }
                        }
                        
                        lastBookingsHash = '';
                        renderNewBooks();
                        renderBooks();
                        alert('âœ… ë§¤ë‹ˆì €ê°€ ë°°ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    } else {
                        showSyncStatus('error', 'âŒ ë°°ì • ì‹¤íŒ¨');
                        selectElement.value = oldManager;
                        alert('âŒ ë°°ì • ì‹¤íŒ¨: ' + apiResult.message);
                    }
                } catch (error) {
                    showSyncStatus('error', 'âŒ ì„œë²„ ì˜¤ë¥˜');
                    selectElement.value = oldManager;
                    
                    alert('âŒ ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            });
        }

        // â­ ë°°ì • ì „ì†¡ - API ì—°ë™
        async function sendAssign(id) {
            var booking = null;
            for (var i = 0; i < bookings.length; i++) {
                if (bookings[i].id === id) {
                    booking = bookings[i];
                    break;
                }
            }
            
            if (!booking || !booking.manager || booking.manager === 'ë¯¸ë°°ì •') {
                alert('ë¨¼ì € ë§¤ë‹ˆì €ë¥¼ ë°°ì •í•´ì£¼ì„¸ìš”!');
                return;
            }

            var confirmMsg = 'ì¼ì •ì„ ì „ì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\në§¤ë‹ˆì €: ' + booking.manager + '\nê³ ê°: ' + booking.name + '\në‚ ì§œ: ' + booking.serviceDate;
            
            showConfirm(confirmMsg, async function(result) {
                if (!result) return;
                
                showSyncStatus('syncing', 'ğŸ”„ ë°°ì • ì „ì†¡ ì¤‘...');
                
                try {
                    var response = await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'updateBooking',
                            id: id,
                            assignmentSent: true,
                            status: 'confirmed'
                        })
                    });
                    
                    var apiResult = await response.json();
                    
                    if (apiResult.success) {
                        showSyncStatus('success', 'âœ… ì „ì†¡ ì™„ë£Œ');
                        booking.assignmentSent = true;
                        booking.status = 'confirmed';
                        
                        lastBookingsHash = '';
                        renderNewBooks();
                        renderBooks();
                        alert('âœ… ' + booking.manager + 'ë‹˜ì—ê²Œ ì¼ì •ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    } else {
                        showSyncStatus('error', 'âŒ ì „ì†¡ ì‹¤íŒ¨');
                        alert('âŒ ì „ì†¡ ì‹¤íŒ¨: ' + apiResult.message);
                    }
                } catch (error) {
                    showSyncStatus('error', 'âŒ ì„œë²„ ì˜¤ë¥˜');
                    
                    alert('âŒ ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            });
        }

        // â­ ì…ê¸ˆì™„ë£Œ ì²˜ë¦¬ - API ì—°ë™
        async function markAsPaid(id, name) {
            showConfirm('"' + name + '" ê³ ê°ì˜ ì…ê¸ˆì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆê¹Œ?', async function(result) {
                if (!result) return;
                
                showSyncStatus('syncing', 'ğŸ”„ ì…ê¸ˆ ì²˜ë¦¬ ì¤‘...');
                
                try {
                    var response = await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'updatePayment',
                            bookingId: id
                        })
                    });
                    
                    var apiResult = await response.json();
                    
                    if (apiResult.success) {
                        showSyncStatus('success', 'âœ… ì…ê¸ˆ ì™„ë£Œ');
                        await loadBooks();
                        alert('âœ… ì…ê¸ˆì™„ë£Œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    } else {
                        showSyncStatus('error', 'âŒ ì²˜ë¦¬ ì‹¤íŒ¨');
                        alert('âŒ ì…ê¸ˆ ì²˜ë¦¬ ì‹¤íŒ¨: ' + apiResult.message);
                    }
                } catch (error) {
                    showSyncStatus('error', 'âŒ ì„œë²„ ì˜¤ë¥˜');
                    
                    alert('âŒ ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            });
        }

        // â­ ì˜ˆì•½ ì‚­ì œ - API ì—°ë™
        async function deleteBooking(id, name) {
            showConfirm('ì •ë§ë¡œ "' + name + '"ë‹˜ì˜ ì˜ˆì•½ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', async function(result) {
                if (!result) return;
                
                showSyncStatus('syncing', 'ğŸ”„ ì˜ˆì•½ ì‚­ì œ ì¤‘...');
                
                try {
                    var response = await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'deleteBooking',
                            id: id
                        })
                    });
                    
                    var apiResult = await response.json();
                    
                    if (apiResult.success) {
                        showSyncStatus('success', 'âœ… ì‚­ì œ ì™„ë£Œ');
                        await loadBooks();
                        alert('âœ… ì˜ˆì•½ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    } else {
                        showSyncStatus('error', 'âŒ ì‚­ì œ ì‹¤íŒ¨');
                        alert('âŒ ì‚­ì œ ì‹¤íŒ¨: ' + apiResult.message);
                    }
                } catch (error) {
                    showSyncStatus('error', 'âŒ ì„œë²„ ì˜¤ë¥˜');
                    
                    alert('âŒ ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            });
        }

        // ì˜ˆì•½ ìˆ˜ì •
        async function editBooking(booking) {
            var newName = prompt('ì´ë¦„:', booking.name);
            if (newName === null) return;
            
            var newPhone = prompt('ì „í™”ë²ˆí˜¸:', booking.phone);
            if (newPhone === null) return;
            
            var newAddress = prompt('ì£¼ì†Œ:', booking.address);
            if (newAddress === null) return;
            
            var newServiceDate = prompt('ì„œë¹„ìŠ¤ ë‚ ì§œ (YYYY-MM-DD):', booking.serviceDate);
            if (newServiceDate === null) return;
            
            var confirmMsg = 'ì˜ˆì•½ ì •ë³´ë¥¼ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ë¦„: ' + newName + '\nì „í™”: ' + newPhone + '\nì£¼ì†Œ: ' + newAddress + '\në‚ ì§œ: ' + newServiceDate;
            
            showConfirm(confirmMsg, async function(result) {
                if (!result) return;
                
                showSyncStatus('syncing', 'ğŸ”„ ì˜ˆì•½ ìˆ˜ì • ì¤‘...');
                
                try {
                    var response = await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'updateBooking',
                            id: booking.id,
                            name: newName,
                            phone: newPhone,
                            address: newAddress,
                            serviceDate: newServiceDate
                        })
                    });
                    
                    var apiResult = await response.json();
                    
                    if (apiResult.success) {
                        showSyncStatus('success', 'âœ… ìˆ˜ì • ì™„ë£Œ');
                        await loadBooks();
                        alert('âœ… ì˜ˆì•½ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    } else {
                        showSyncStatus('error', 'âŒ ìˆ˜ì • ì‹¤íŒ¨');
                        alert('âŒ ìˆ˜ì • ì‹¤íŒ¨: ' + apiResult.message);
                    }
                } catch (error) {
                    showSyncStatus('error', 'âŒ ì„œë²„ ì˜¤ë¥˜');
                    
                    alert('âŒ ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            });
        }

        // ========================================
        // ì¬ì •ê´€ë¦¬
        // ========================================
        function renderFinance() {
            var tbody = document.getElementById('financeBody');
            tbody.innerHTML = '';
            
            var completedBookings = bookings.filter(function(b) { 
                return b.status === 'completed' || b.status === 'paid';
            });

            if (completedBookings.length === 0) {
                tbody.innerHTML = '<tr><td colspan="16" style="text-align: center; color: #999; padding: 40px;">ì™„ë£Œëœ ì˜ˆì•½ì´ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                return;
            }

            var totalRevenue = 0, totalManagerPay = 0, totalProfit = 0, totalUnpaid = 0;

            for (var i = 0; i < completedBookings.length; i++) {
                var b = completedBookings[i];
                var row = document.createElement('tr');
                
                row.innerHTML = '<td style="text-align: center;">' + (i + 1) + '</td>' +
                    '<td>' + (b.receivedDate || '-') + '</td>' +
                    '<td>' + (b.serviceDate || 'ë¯¸ì§€ì •') + '</td>' +
                    '<td><strong>' + b.name + '</strong><br><small>' + b.phone + '</small><br><small style="color:#666;">' + b.address + '</small></td>' +
                    '<td style="text-align: center;">' + extractSize(b.size || '', b.service || '') + '</td>' +
                    '<td>' + extractService(b.service || b.items || '') + '</td>' +
                    '<td style="text-align: center;">' + (b.manager || 'ë¯¸ë°°ì •') + '</td>' +
                    '<td style="text-align: center; font-weight: bold; color: ' + (b.status === 'paid' ? '#27ae60' : '#f39c12') + ';">' + (b.status === 'paid' ? 'ì…ê¸ˆì™„ë£Œ' : 'ì‘ì—…ì™„ë£Œ') + '</td>';
                
                var revenue = b.revenue || getPrice(b.size || '', b.service || '');
                totalRevenue += revenue;
                row.innerHTML += '<td style="text-align: right; font-weight: bold;">' + revenue.toLocaleString() + '</td>';
                
                var managerPay = b.managerPay || 0;
                totalManagerPay += managerPay;
                row.innerHTML += '<td style="text-align: right; color: #e74c3c;">' + managerPay.toLocaleString() + '</td>';
                
                var profit = revenue - managerPay;
                totalProfit += profit;
                row.innerHTML += '<td style="text-align: right; font-weight: bold; color: ' + (profit >= 0 ? '#27ae60' : '#e74c3c') + ';">' + profit.toLocaleString() + '</td>';
                
                row.innerHTML += '<td style="text-align: center;">' + (b.paymentMethod || 'ë¯¸ì§€ì •') + '</td>';
                row.innerHTML += '<td style="text-align: center;">' + (b.paymentDate || '-') + '</td>';
                
                var unpaid = b.unpaid || 0;
                totalUnpaid += unpaid;
                row.innerHTML += '<td style="text-align: right; color: ' + (unpaid > 0 ? '#e74c3c' : '#27ae60') + '; font-weight: bold;">' + unpaid.toLocaleString() + '</td>';
                
                row.innerHTML += '<td style="text-align: center;">' + (b.category || 'ê°œì¸') + '</td>';
                row.innerHTML += '<td style="text-align: center;"><button class="btn btn-info" style="padding: 6px 12px;" onclick="editFinanceRecord(\'' + b.id + '\')">âœï¸</button></td>';
                
                tbody.appendChild(row);
            }
            
            var totalRow = document.createElement('tr');
            totalRow.style.background = '#f0f8ff';
            totalRow.style.fontWeight = 'bold';
            totalRow.style.borderTop = '3px solid #00AEEF';
            totalRow.innerHTML = 
                '<td colspan="8" style="text-align: right; padding-right: 20px; font-size: 18px;">ì´ê³„</td>' +
                '<td style="text-align: right; color: #2c3e50; font-size: 18px;">' + totalRevenue.toLocaleString() + 'ì›</td>' +
                '<td style="text-align: right; color: #e74c3c; font-size: 18px;">' + totalManagerPay.toLocaleString() + 'ì›</td>' +
                '<td style="text-align: right; color: #27ae60; font-size: 20px;">' + totalProfit.toLocaleString() + 'ì›</td>' +
                '<td colspan="2"></td>' +
                '<td style="text-align: right; color: #e74c3c; font-size: 18px;">' + totalUnpaid.toLocaleString() + 'ì›</td>' +
                '<td colspan="2"></td>';
            tbody.appendChild(totalRow);
        }

        function editFinanceRecord(bookingId) {
            var booking = null;
            for (var i = 0; i < bookings.length; i++) {
                if (bookings[i].id === bookingId) {
                    booking = bookings[i];
                    break;
                }
            }
            if (!booking) return;
            
            var newRevenue = prompt('ì´ë§¤ì¶œ (ì›):', booking.revenue || getPrice(booking.size || '', booking.service || ''));
            if (newRevenue === null) return;
            
            var newManagerPay = prompt('ë§¤ë‹ˆì €í˜ì´ (ì›):', booking.managerPay || 0);
            if (newManagerPay === null) return;
            
            showConfirm('ì¬ì • ì •ë³´ë¥¼ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?', async function(result) {
                if (!result) return;
                
                showSyncStatus('syncing', 'ğŸ”„ ì¬ì • ì •ë³´ ìˆ˜ì • ì¤‘...');
                
                try {
                    var response = await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'updateBooking',
                            id: bookingId,
                            revenue: parseInt(newRevenue) || 0,
                            managerPay: parseInt(newManagerPay) || 0
                        })
                    });
                    
                    var apiResult = await response.json();
                    
                    if (apiResult.success) {
                        showSyncStatus('success', 'âœ… ìˆ˜ì • ì™„ë£Œ');
                        await loadBooks();
                        alert('âœ… ì¬ì • ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    } else {
                        showSyncStatus('error', 'âŒ ìˆ˜ì • ì‹¤íŒ¨');
                        alert('âŒ ìˆ˜ì • ì‹¤íŒ¨: ' + apiResult.message);
                    }
                } catch (error) {
                    showSyncStatus('error', 'âŒ ì„œë²„ ì˜¤ë¥˜');
                    alert('âŒ ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            });
        }

        function updateStats() {
            document.getElementById('totalCount').textContent = bookings.length;
            document.getElementById('receivedCount').textContent = bookings.filter(function(b) { 
                return b.status === 'received' && b.assignmentSent !== true; 
            }).length;
            document.getElementById('confirmedCount').textContent = bookings.filter(function(b) { return b.status === 'confirmed'; }).length;
            document.getElementById('startedCount').textContent = bookings.filter(function(b) { return b.status === 'started' || b.status === 'scheduled'; }).length;
            document.getElementById('completedCount').textContent = bookings.filter(function(b) { return b.status === 'completed'; }).length;
            document.getElementById('paidCount').textContent = bookings.filter(function(b) { return b.status === 'paid'; }).length;
        }

        // ========================================
        // ìº˜ë¦°ë”
        // ========================================
        function showBigCalendar() {
            document.getElementById('bigCalendarModal').classList.add('show');
            bigCalYear = new Date().getFullYear();
            bigCalMonth = new Date().getMonth();
            renderBigCalendar();
        }

        function hideBigCalendar() {
            document.getElementById('bigCalendarModal').classList.remove('show');
        }

        function prevBigMonth() {
            bigCalMonth--;
            if (bigCalMonth < 0) { bigCalMonth = 11; bigCalYear--; }
            renderBigCalendar();
        }

        function nextBigMonth() {
            bigCalMonth++;
            if (bigCalMonth > 11) { bigCalMonth = 0; bigCalYear++; }
            renderBigCalendar();
        }

        function renderBigCalendar() {
            var monthNames = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
            document.getElementById('bigCalendarTitle').textContent = bigCalYear + 'ë…„ ' + monthNames[bigCalMonth];

            var firstDay = new Date(bigCalYear, bigCalMonth, 1).getDay();
            var daysInMonth = new Date(bigCalYear, bigCalMonth + 1, 0).getDate();

            var container = document.getElementById('bigCalendarDays');
            container.innerHTML = '';

            for (var i = 0; i < firstDay; i++) {
                var empty = document.createElement('div');
                empty.className = 'calendar-big-day empty';
                container.appendChild(empty);
            }

            for (var day = 1; day <= daysInMonth; day++) {
                var dateStr = bigCalYear + '-' + String(bigCalMonth + 1).padStart(2, '0') + '-' + String(day).padStart(2, '0');
                var dayBookings = bookings.filter(function(b) { return b.serviceDate === dateStr; });

                var dayDiv = document.createElement('div');
                dayDiv.className = 'calendar-big-day';
                
                var numDiv = document.createElement('div');
                numDiv.className = 'calendar-big-day-number';
                numDiv.textContent = day;
                dayDiv.appendChild(numDiv);

                if (dayBookings.length > 0) {
                    dayDiv.classList.add('has-bookings');
                    var countDiv = document.createElement('div');
                    countDiv.className = 'calendar-booking-count';
                    countDiv.textContent = dayBookings.length + 'ê±´';
                    dayDiv.appendChild(countDiv);

                    dayDiv.onclick = (function(date, bks) {
                        return function() { showDayBookings(date, bks); };
                    })(dateStr, dayBookings);
                }

                container.appendChild(dayDiv);
            }
        }

        // ========================================
        // ì—‘ì…€ ë‚´ë³´ë‚´ê¸°
        // ========================================
        function exportExcel() {
            if (bookings.length === 0) { 
                alert('ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); 
                return; 
            }
            
            var csv = 'ë‚ ì§œ,ì´ë¦„,ì „í™”,ì£¼ì†Œ,í‰í˜•,ì„œë¹„ìŠ¤,ë§¤ë‹ˆì €,ìƒíƒœ,ë§¤ì¶œ,ë§¤ë‹ˆì €ë¹„ìš©,ìˆœì´ìµ\n';
            
            var totalRevenue = 0, totalCost = 0, totalProfit = 0;
            
            for (var i = 0; i < bookings.length; i++) {
                var b = bookings[i];
                var revenue = b.revenue || getPrice(b.size || '', b.service || '');
                var cost = b.managerPay || 0;
                var profit = revenue - cost;
                
                if (b.status === 'completed' || b.status === 'paid') {
                    totalRevenue += revenue;
                    totalCost += cost;
                    totalProfit += profit;
                }
                
                var statusText = b.status === 'received' ? 'ì˜ˆì•½ì ‘ìˆ˜' : 
                                b.status === 'confirmed' ? 'ì˜ˆì•½í™•ì •' :
                                b.status === 'scheduled' ? 'ìŠ¤ì¼€ì¤„í”½ìŠ¤' :
                                b.status === 'started' ? 'ì‘ì—…ì‹œì‘' :
                                b.status === 'completed' ? 'ì‘ì—…ì™„ë£Œ' :
                                b.status === 'paid' ? 'ì…ê¸ˆì™„ë£Œ' : b.status;
                
                csv += '"' + (b.serviceDate || 'ë¯¸ì§€ì •') + '","' + b.name + '","' + b.phone + '","' + 
                       b.address + '","' + extractSize(b.size || '', b.service || '') + '","' + 
                       extractService(b.service || b.items || '') + '","' + 
                       (b.manager || 'ë¯¸ë°°ì •') + '","' + statusText + '","' + 
                       revenue + '","' + cost + '","' + profit + '"\n';
            }
            
            csv += '\n"ì´ í•©ê³„","","","","","","","","' + totalRevenue + '","' + totalCost + '","' + totalProfit + '"\n';
            
            var BOM = "\uFEFF";
            var blob = new Blob([BOM + csv], { type: 'text/csv;charset=utf-8;' });
            var link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'ê¹¨ë—í•œì§‘_ì¬ì •ê´€ë¦¬_' + new Date().toISOString().split('T')[0] + '.csv';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert('âœ… ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ!');
        }

        // ========================================
        // ì•„íŒŒíŠ¸ ê°€ê²© ê´€ë¦¬
        // ========================================
        var apartmentPrices = [];
        var editingApartmentId = null;

        async function loadApartmentPrices() {
            try {
                var response = await fetch(GOOGLE_SCRIPT_URL + '?action=getApartmentPrices');
                var data = await response.json();
                if (data.success) {
                    apartmentPrices = data.apartments || [];
                    renderApartmentPrices();
                }
            } catch (error) {
                
            }
        }

        function renderApartmentPrices() {
            var container = document.getElementById('apartmentPriceList');
            
            if (apartmentPrices.length === 0) {
                container.innerHTML = '<p style="color: #888; text-align: center; padding: 40px;">ë“±ë¡ëœ ì•„íŒŒíŠ¸ ë‹¨ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            var html = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px;">';
            
            apartmentPrices.forEach(function(apt) {
                html += '<div style="background: #f8f9fa; border-radius: 12px; padding: 20px; border-left: 4px solid #00AEEF;">' +
                    '<div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">' +
                    '<div><h3 style="font-size: 18px; font-weight: 800; color: #2c3e50; margin: 0;">' + apt.name + '</h3>' +
                    (apt.keywords ? '<p style="font-size: 11px; color: #888; margin-top: 5px;">ğŸ” ' + apt.keywords + '</p>' : '') +
                    '</div>' +
                    '<div>' +
                    '<button class="btn btn-info" style="padding: 8px 12px; font-size: 12px; margin-right: 5px;" onclick="editApartment(\'' + String(apt.id).replace(/'/g, "\\'") + '\')">ìˆ˜ì •</button>' +
                    '<button class="btn btn-danger" style="padding: 8px 12px; font-size: 12px;" onclick="deleteApartment(\'' + String(apt.id).replace(/'/g, "\\'") + '\', \'' + String(apt.name).replace(/'/g, "\\'") + '\')">ì‚­ì œ</button>' +
                    '</div></div>' +
                    '<div style="display: grid; grid-template-columns: auto 1fr; gap: 8px; font-size: 13px;">' +
                    '<strong style="color: #555;">30í‰í˜•:</strong><div>ë‚œë°© ' + (apt.price30heating || 0).toLocaleString() + 'ì› / ìˆ˜ë„ ' + (apt.price30water || 0).toLocaleString() + 'ì›</div>' +
                    '<strong style="color: #555;">40í‰í˜•:</strong><div>ë‚œë°© ' + (apt.price40heating || 0).toLocaleString() + 'ì› / ìˆ˜ë„ ' + (apt.price40water || 0).toLocaleString() + 'ì›</div>' +
                    '<strong style="color: #555;">50í‰í˜•:</strong><div>ë‚œë°© ' + (apt.price50heating || 0).toLocaleString() + 'ì› / ìˆ˜ë„ ' + (apt.price50water || 0).toLocaleString() + 'ì›</div>' +
                    '<strong style="color: #555;">60í‰í˜•:</strong><div>ë‚œë°© ' + (apt.price60heating || 0).toLocaleString() + 'ì› / ìˆ˜ë„ ' + (apt.price60water || 0).toLocaleString() + 'ì›</div>' +
                    '</div></div>';
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function showAddApartmentModal() {
            editingApartmentId = null;
            document.getElementById('apartmentModalTitle').textContent = 'ğŸ˜ï¸ ì•„íŒŒíŠ¸ ë‹¨ì§€ ì¶”ê°€';
            document.getElementById('apartmentName').value = '';
            document.getElementById('apartmentKeywords').value = '';
            document.getElementById('price30heating').value = '120000';
            document.getElementById('price30water').value = '120000';
            document.getElementById('price30both').value = '150000';
            document.getElementById('price40heating').value = '140000';
            document.getElementById('price40water').value = '140000';
            document.getElementById('price40both').value = '180000';
            document.getElementById('price50heating').value = '160000';
            document.getElementById('price50water').value = '160000';
            document.getElementById('price50both').value = '200000';
            document.getElementById('price60heating').value = '180000';
            document.getElementById('price60water').value = '180000';
            document.getElementById('price60both').value = '220000';
            document.getElementById('apartmentModal').classList.add('show');
        }

        function hideApartmentModal() {
            document.getElementById('apartmentModal').classList.remove('show');
            editingApartmentId = null;
        }

        function editApartment(aptId) {
            var apt = apartmentPrices.find(function(a) { return a.id === aptId; });
            if (!apt) return;

            editingApartmentId = aptId;
            document.getElementById('apartmentModalTitle').textContent = 'ğŸ˜ï¸ ì•„íŒŒíŠ¸ ë‹¨ì§€ ìˆ˜ì •';
            document.getElementById('apartmentName').value = apt.name;
            document.getElementById('apartmentKeywords').value = apt.keywords || '';
            document.getElementById('price30heating').value = apt.price30heating || 120000;
            document.getElementById('price30water').value = apt.price30water || 120000;
            document.getElementById('price30both').value = apt.price30both || 150000;
            document.getElementById('price40heating').value = apt.price40heating || 140000;
            document.getElementById('price40water').value = apt.price40water || 140000;
            document.getElementById('price40both').value = apt.price40both || 180000;
            document.getElementById('price50heating').value = apt.price50heating || 160000;
            document.getElementById('price50water').value = apt.price50water || 160000;
            document.getElementById('price50both').value = apt.price50both || 200000;
            document.getElementById('price60heating').value = apt.price60heating || 180000;
            document.getElementById('price60water').value = apt.price60water || 180000;
            document.getElementById('price60both').value = apt.price60both || 220000;
            document.getElementById('apartmentModal').classList.add('show');
        }

        async function saveApartment() {
            var name = document.getElementById('apartmentName').value.trim();
            if (!name) {
                alert('ì•„íŒŒíŠ¸ ë‹¨ì§€ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            showSyncStatus('syncing', 'ğŸ”„ ì•„íŒŒíŠ¸ ì €ì¥ ì¤‘...');

            var apartmentData = {
                action: editingApartmentId ? 'updateApartment' : 'addApartment',
                id: editingApartmentId || 'apt_' + Date.now(),
                name: name,
                keywords: document.getElementById('apartmentKeywords').value.trim(),
                price30heating: parseInt(document.getElementById('price30heating').value) || 120000,
                price30water: parseInt(document.getElementById('price30water').value) || 120000,
                price30both: parseInt(document.getElementById('price30both').value) || 150000,
                price40heating: parseInt(document.getElementById('price40heating').value) || 140000,
                price40water: parseInt(document.getElementById('price40water').value) || 140000,
                price40both: parseInt(document.getElementById('price40both').value) || 180000,
                price50heating: parseInt(document.getElementById('price50heating').value) || 160000,
                price50water: parseInt(document.getElementById('price50water').value) || 160000,
                price50both: parseInt(document.getElementById('price50both').value) || 200000,
                price60heating: parseInt(document.getElementById('price60heating').value) || 180000,
                price60water: parseInt(document.getElementById('price60water').value) || 180000,
                price60both: parseInt(document.getElementById('price60both').value) || 220000
            };

            try {
                var response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(apartmentData)
                });
                
                var apiResult = await response.json();
                
                if (apiResult.success) {
                    showSyncStatus('success', 'âœ… ì €ì¥ ì™„ë£Œ');
                    hideApartmentModal();
                    await loadApartmentPrices();
                    alert(editingApartmentId ? 'ì•„íŒŒíŠ¸ ê°€ê²©ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ì•„íŒŒíŠ¸ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    showSyncStatus('error', 'âŒ ì €ì¥ ì‹¤íŒ¨');
                    alert('ì €ì¥ ì‹¤íŒ¨: ' + apiResult.message);
                }
            } catch (error) {
                showSyncStatus('error', 'âŒ ì„œë²„ ì˜¤ë¥˜');
                
                alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        async function deleteApartment(aptId, aptName) {
            if (!confirm('"' + aptName + '" ì•„íŒŒíŠ¸ ë‹¨ì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            showSyncStatus('syncing', 'ğŸ”„ ì•„íŒŒíŠ¸ ì‚­ì œ ì¤‘...');

            try {
                var response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'deleteApartment',
                        id: aptId
                    })
                });
                
                var apiResult = await response.json();
                
                if (apiResult.success) {
                    showSyncStatus('success', 'âœ… ì‚­ì œ ì™„ë£Œ');
                    await loadApartmentPrices();
                    alert('ì•„íŒŒíŠ¸ ë‹¨ì§€ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    showSyncStatus('error', 'âŒ ì‚­ì œ ì‹¤íŒ¨');
                    alert('ì‚­ì œ ì‹¤íŒ¨: ' + apiResult.message);
                }
            } catch (error) {
                showSyncStatus('error', 'âŒ ì„œë²„ ì˜¤ë¥˜');
                
                alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ========================================
        // í˜ì´ì§€ ë¡œë“œ
        // ========================================
        window.addEventListener('load', function() {
            
            // â­ ë¡œê·¸ì¸ ì²´í¬ - ë¡œê·¸ì¸ë˜ì–´ ìˆì„ ë•Œë§Œ ë°ì´í„° ë¡œë“œ
            if (!checkAdminLogin()) {
                return; // ë¡œê·¸ì¸ ì•ˆë˜ì–´ ìˆìœ¼ë©´ ë°ì´í„° ë¡œë“œ ì•ˆí•¨
            }
            
            loadMgrs();
            loadBooks();
            loadApartmentPrices();
            
            // â­ í´ë§ ê´€ë¦¬ (ë°±ê·¸ë¼ìš´ë“œ ì‹œ ì¤‘ì§€ë¡œ ë°°í„°ë¦¬/ì„œë²„ ë¶€í•˜ ì ˆê°)
            var pollingIntervals = [];
            
            function startPolling() {
                if (pollingIntervals.length === 0) {
                    pollingIntervals.push(setInterval(loadBooks, 5000));
                    pollingIntervals.push(setInterval(loadApartmentPrices, 5000));
                    pollingIntervals.push(setInterval(loadMgrs, 5000));
                }
            }
            
            function stopPolling() {
                pollingIntervals.forEach(function(id) { clearInterval(id); });
                pollingIntervals = [];
            }
            
            // í˜ì´ì§€ ê°€ì‹œì„± ë³€ê²½ ì‹œ í´ë§ ì œì–´
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    stopPolling();
                } else {
                    loadBooks();  // ëŒì•„ì™”ì„ ë•Œ ì¦‰ì‹œ ìƒˆë¡œê³ ì¹¨
                    startPolling();
                }
            });
            
            startPolling();
        });
    </script>
</body>
</html>
